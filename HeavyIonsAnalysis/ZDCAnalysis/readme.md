# ZDC analyzer
## Minimum usage
Energy sum is `(float) sumPlus` and `(float) sumMinus` in `zdcanalyzer/zdcrechit`.
```
   (HiForestMiniAOD.root)
   ./
    └── (TDirectoryFile) => zdcanalyzer
        ├── (TTree) => zdcrechit (1)
        └── (TTree) => zdcdigi (1)
```
## Branches
```
   (HiForestMiniAOD.root)
   ./
    └── (TDirectoryFile) => zdcanalyzer
        ├── (TTree) => zdcrechit (1)
******************************************************************************
*Tree    :zdcrechit : zdcrechit                                              *
******************************************************************************
*Br    0 :sumPlus   : sumPlus/F                                              *
*............................................................................*
*Br    1 :sumMinus  : sumMinus/F                                             *
*............................................................................*
*Br    2 :n         : n/I                                                    *
*............................................................................*
*Br    3 :zside     : zside[n]/I                                             *
*............................................................................*
*Br    4 :section   : section[n]/I                                           *
*............................................................................*
*Br    5 :channel   : channel[n]/I                                           *
*............................................................................*
*Br    6 :energy    : energy[n]/F                                            *
*............................................................................*
*Br    7 :time      : time[n]/F                                              *
*............................................................................*
*Br    8 :TDCtime   : TDCtime[n]/F                                           *
*............................................................................*
*Br    9 :chargeWeightedTime : chargeWeightedTime[n]/F                       *
*............................................................................*
*Br   10 :energySOIp1 : energySOIp1[n]/F                                     *
*............................................................................*
*Br   11 :ratioSOIp1 : ratioSOIp1[n]/F                                       *
*............................................................................*
*Br   12 :saturation : saturation[n]/I                                       *
*............................................................................*
*Br   13 :sumPlus_Aux : sumPlus_Aux/F                                        *
*............................................................................*
*Br   14 :sumMinus_Aux : sumMinus_Aux/F                                      *
*............................................................................*

        └── (TTree) => zdcdigi (1)
******************************************************************************
*Tree    :zdcdigi   : zdcdigi                                                *
******************************************************************************
*Br    0 :n         : n/I                                                    *
*............................................................................*
*Br    1 :zside     : zside[n]/I                                             *
*............................................................................*
*Br    2 :section   : section[n]/I                                           *
*............................................................................*
*Br    3 :channel   : channel[n]/I                                           *
*............................................................................*
*Br    4 :adcTs0    : adcTs0[n]/I                                            *
*............................................................................*
*Br    5 :chargefCTs0 : chargefCTs0[n]/F                                     *
*............................................................................*
*Br    6 :tdcTs0    : tdcTs0[n]/I                                            *
*............................................................................*
*Br    7 :adcTs1    : adcTs1[n]/I                                            *
*............................................................................*
*Br    8 :chargefCTs1 : chargefCTs1[n]/F                                     *
*............................................................................*
*Br    9 :tdcTs1    : tdcTs1[n]/I                                            *
*............................................................................*
*Br   10 :adcTs2    : adcTs2[n]/I                                            *
*............................................................................*
*Br   11 :chargefCTs2 : chargefCTs2[n]/F                                     *
*............................................................................*
*Br   12 :tdcTs2    : tdcTs2[n]/I                                            *
*............................................................................*
*Br   13 :adcTs3    : adcTs3[n]/I                                            *
*............................................................................*
*Br   14 :chargefCTs3 : chargefCTs3[n]/F                                     *
*............................................................................*
*Br   15 :tdcTs3    : tdcTs3[n]/I                                            *
*............................................................................*
*Br   16 :adcTs4    : adcTs4[n]/I                                            *
*............................................................................*
*Br   17 :chargefCTs4 : chargefCTs4[n]/F                                     *
*............................................................................*
*Br   18 :tdcTs4    : tdcTs4[n]/I                                            *
*............................................................................*
*Br   19 :adcTs5    : adcTs5[n]/I                                            *
*............................................................................*
*Br   20 :chargefCTs5 : chargefCTs5[n]/F                                     *
*............................................................................*
*Br   21 :tdcTs5    : tdcTs5[n]/I                                            *
*............................................................................*
```

## Indices and dimensions
- By default, the 18 channels of ZDC are saved in rechit tree, while additional 32 RPD channels are saved in digi tree.
```
   (HiForestMiniAOD.root)
   ./
    └── (TDirectoryFile) => zdcanalyzer
        ├── (TTree) => zdcrechit (1)
***********************************************************************
*    Row   * Instance *         n *     zside *   section *   channel *
***********************************************************************
*        0 *        0 *        18 *        -1 *         1 *         1 *
*        0 *        1 *        18 *        -1 *         1 *         2 *
*        0 *        2 *        18 *        -1 *         1 *         3 *
*        0 *        3 *        18 *        -1 *         1 *         4 *
*        0 *        4 *        18 *        -1 *         1 *         5 *
*        0 *        5 *        18 *        -1 *         2 *         1 *
*        0 *        6 *        18 *        -1 *         2 *         2 *
*        0 *        7 *        18 *        -1 *         2 *         3 *
*        0 *        8 *        18 *        -1 *         2 *         4 *
*        0 *        9 *        18 *         1 *         1 *         1 *
*        0 *       10 *        18 *         1 *         1 *         2 *
*        0 *       11 *        18 *         1 *         1 *         3 *
*        0 *       12 *        18 *         1 *         1 *         4 *
*        0 *       13 *        18 *         1 *         1 *         5 *
*        0 *       14 *        18 *         1 *         2 *         1 *
*        0 *       15 *        18 *         1 *         2 *         2 *
*        0 *       16 *        18 *         1 *         2 *         3 *
*        0 *       17 *        18 *         1 *         2 *         4 *
***********************************************************************

        └── (TTree) => zdcdigi (1)
***********************************************************************
*    Row   * Instance *         n *     zside *   section *   channel *
***********************************************************************
*        0 *        0 *        50 *        -1 *         1 *         1 *
*        0 *        1 *        50 *        -1 *         1 *         2 *
*        0 *        2 *        50 *        -1 *         1 *         3 *
*        0 *        3 *        50 *        -1 *         1 *         4 *
*        0 *        4 *        50 *        -1 *         1 *         5 *
*        0 *        5 *        50 *        -1 *         2 *         1 *
*        0 *        6 *        50 *        -1 *         2 *         2 *
*        0 *        7 *        50 *        -1 *         2 *         3 *
*        0 *        8 *        50 *        -1 *         2 *         4 *
*        0 *        9 *        50 *         1 *         1 *         1 *
*        0 *       10 *        50 *         1 *         1 *         2 *
*        0 *       11 *        50 *         1 *         1 *         3 *
*        0 *       12 *        50 *         1 *         1 *         4 *
*        0 *       13 *        50 *         1 *         1 *         5 *
*        0 *       14 *        50 *         1 *         2 *         1 *
*        0 *       15 *        50 *         1 *         2 *         2 *
*        0 *       16 *        50 *         1 *         2 *         3 *
*        0 *       17 *        50 *         1 *         2 *         4 *
*        0 *       18 *        50 *        -1 *         4 *         1 *
*        0 *       19 *        50 *        -1 *         4 *         2 *
*        0 *       20 *        50 *        -1 *         4 *         3 *
*        0 *       21 *        50 *        -1 *         4 *         4 *
*        0 *       22 *        50 *        -1 *         4 *         5 *
*        0 *       23 *        50 *        -1 *         4 *         6 *
*        0 *       24 *        50 *        -1 *         4 *         7 *
*        0 *       25 *        50 *        -1 *         4 *         8 *
*        0 *       26 *        50 *        -1 *         4 *         9 *
*        0 *       27 *        50 *        -1 *         4 *        10 *
*        0 *       28 *        50 *        -1 *         4 *        11 *
*        0 *       29 *        50 *        -1 *         4 *        12 *
*        0 *       30 *        50 *        -1 *         4 *        13 *
*        0 *       31 *        50 *        -1 *         4 *        14 *
*        0 *       32 *        50 *        -1 *         4 *        15 *
*        0 *       33 *        50 *        -1 *         4 *        16 *
*        0 *       34 *        50 *         1 *         4 *         1 *
*        0 *       35 *        50 *         1 *         4 *         2 *
*        0 *       36 *        50 *         1 *         4 *         3 *
*        0 *       37 *        50 *         1 *         4 *         4 *
*        0 *       38 *        50 *         1 *         4 *         5 *
*        0 *       39 *        50 *         1 *         4 *         6 *
*        0 *       40 *        50 *         1 *         4 *         7 *
*        0 *       41 *        50 *         1 *         4 *         8 *
*        0 *       42 *        50 *         1 *         4 *         9 *
*        0 *       43 *        50 *         1 *         4 *        10 *
*        0 *       44 *        50 *         1 *         4 *        11 *
*        0 *       45 *        50 *         1 *         4 *        12 *
*        0 *       46 *        50 *         1 *         4 *        13 *
*        0 *       47 *        50 *         1 *         4 *        14 *
*        0 *       48 *        50 *         1 *         4 *        15 *
*        0 *       49 *        50 *         1 *         4 *        16 *
***********************************************************************
```
- The safe length of the arrays is 56 = (9 ZDC + 16 RPD + 3 dump) &times; 2 sides, no matter if RPD is skipped, e.g.
```
#define MAXMOD 56 
int zside[MAXMOD];
```

## Options and parameters
### ZDC analyzer
- Hard coded RPD `doHardcodedRPD`: Geometry updated for the RPD are not part of 14_1_X and the GT used for 2024. Always do hard coded RPD for 2024.
- Remove digi tree: `process.zdcanalyzer.doZdcDigis = cms.bool(False)`
- Save RPD rechit: `process.zdcanalyzer.skipRpdRecHits = cms.bool(False)`
- Remove RPD digi: `process.zdcanalyzer.skipRpdDigis = cms.bool(True)`
- Add Aux
```
process.zdcanalyzer.doAuxZdcRecHits = cms.bool(True)
process.zdcanalyzer.AuxZDCRecHitSource = cms.InputTag('your zdc rechit label')
```

# ZDC rechit producer
## Options and parameters
| | correctionMethodHAD | correctionMethodEM | ootpuRatioHAD | ootpuRatioEM | ootpuFracHAD | ootpuFracEM |
| :-- | :--: | :--: | :--: | :--: | :--: | :--: |
| Default in `zdcrecoRun3_cfi` (Template fit) | 1 | 1 | 3.0 | 3.0 | 0.4 | 0.4 |
| Trigger (`Ts2-0.4*Ts1`) | 0 | 0 | -1 | -1 | 97.0/256.0 | 97.0/256.0 |
| 2023 offline (`Ts2-Ts1`), default in forest | 0 | 0 | -1 | -1 | 1.0 | 1.0 |
